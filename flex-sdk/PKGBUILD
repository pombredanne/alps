# Contributor: Alper KANAT  <alperkanat@raptiye.org>
pkgname=flex-sdk
pkgver=4.5.0
pkgrel=20967
pkgdesc="Flex is a highly productive, free open source framework for building and maintaining \
         expressive web applications that deploy consistently on all major browsers, desktops, \
         and operating systems."
arch=('i686' 'x86_64')
url="http://www.adobe.com/products/flex/"
license=('custom:Adobe Flex SDK License Agreement' 'MPL')
depends=('flashplugin')
source=('http://fpdownload.adobe.com/pub/flex/sdk/builds/flex4.5/flex_sdk_4.5.0.20967.zip' 'flex_sdk.sh')
install="flex_sdk.install"
options=("!strip")
md5sums=('c92b661eb7b00bb568262851885274dc'
         '496fa1da44083a857cc4bf9123fe4a19')

build() {
    _APP_DIR=$pkgdir/opt/$pkgname
    _LICENSE_DIR=$pkgdir/usr/share/licenses/$pkgname
    _PROFILE_DIR=$pkgdir/etc/profile.d
    _DOC_DIR=$pkgdir/usr/share/doc/$pkgname

    cd $srcdir

    # copying package files..
    echo "Copying package files..."
    mkdir -p $_APP_DIR
    install -m644 flex-sdk-description.xml $_APP_DIR
    cp -r ant $_APP_DIR
    cp -r asdoc $_APP_DIR
    cp -r bin $_APP_DIR
    cp -r frameworks $_APP_DIR
    cp -r lib $_APP_DIR
    cp -r samples $_APP_DIR
    cp -r templates $_APP_DIR
    chmod -R 0755 $_APP_DIR

    # copying license information
    mkdir -p $_LICENSE_DIR
    install -m644 license-adobesdk.htm $_LICENSE_DIR
    install -m644 license-adobesdk-fr.htm $_LICENSE_DIR
    install -m644 license-mpl.htm $_LICENSE_DIR
    install -m644 "AIR SDK license.pdf" $_LICENSE_DIR

    # copying documentation
    mkdir -p $_DOC_DIR
    install -m644 "AIR SDK Readme.txt" $_DOC_DIR
    install -m644 readme.htm $_DOC_DIR

    # copying profile script
    mkdir -p $_PROFILE_DIR
    install -m755 "$srcdir/flex_sdk.sh" $_PROFILE_DIR

    # running dos2unix (available in hd2u package) on certain files
    # dos2unix $_APP_DIR/bin/aasdoc
    # contributed by bubla, thanks!
    sed -i -e 's/\r$//' $_APP_DIR/bin/aasdoc

    # removing any left out exe files
    # contributed by bubla, thanks!
    find $_APP_DIR -name "*.exe" -exec rm '{}' \;
}

